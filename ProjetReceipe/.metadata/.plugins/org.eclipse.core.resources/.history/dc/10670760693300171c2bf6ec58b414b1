package s6.ReceipeFood.service;

import java.util.List;

import org.hibernate.Session;
import org.hibernate.Transaction;

import s6.ReceipeFood.dao.CategorieDAO;
import s6.ReceipeFood.dao.HibernateDao;
import s6.ReceipeFood.dao.ProduitDAO;
import s6.ReceipeFood.modele.BaseModel;
import s6.ReceipeFood.modele.Composition;
import s6.ReceipeFood.modele.Produit;

public class ServiceProduit {
	public ServiceProduit() {}
	
	private static class SingletonHolder
	{		
		private final static ServiceProduit instance = new ServiceProduit();
	}
 
	public static ServiceProduit getInstance()
	{
		return SingletonHolder.instance;
	}
	
	ProduitDAO produitDAO = new ProduitDAO();
	
	public List<BaseModel> find() throws Exception{
		HibernateDao hibernateDao = new HibernateDao();
		return hibernateDao.findAll(new Produit());
	}
	
	public Produit findById(int i) throws Exception{
		return produitDAO.findById(i);
	}
	
	public void ajouterProduit(List<Composition> ltComposition, Produit produit) throws Exception{
		Session session = null;
		try{
			session = HibernateDao.getInstance().getSessionFactory().openSession();
			session.beginTransaction();
			
			for(Composition composition : ltComposition){
				composition = HibernateDao.getInstance().findById(composition);
				HibernateDao.getInstance().save(composition,session);
			}
			HibernateDao.getInstance().save(produit,session);
			
			session.getTransaction().commit();
		}catch(Exception e){
			e.printStackTrace();
			session.getTransaction().rollback();
			session.close();
			throw e;
		}
	}
}
